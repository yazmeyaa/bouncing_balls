var T=Object.defineProperty;var _=(r,i,t)=>i in r?T(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var n=(r,i,t)=>(_(r,typeof i!="symbol"?i+"":i,t),t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class c{constructor(i,t){n(this,"_x",0);n(this,"_y",0);if(typeof i=="object"){const{x:e,y:s}=i;this._x=e,this._y=s;return}i&&(this._x=i),t&&(this._y=t)}get x(){return this._x}get y(){return this._y}getCoords(){return{x:this.x,y:this.y}}setCoords(i,t){this._x=i,this._y=t}setX(i){this._x=i}setY(i){this._y=i}addX(i){this._x+=i}addY(i){this._y+=i}subtractX(i){this._x-=i}subtractY(i){this._y-=i}multiply(i){this._x*=i,this._y*=i}}class u{constructor(i,t){n(this,"a");n(this,"b");!i&&!t?(this.a=new c,this.b=new c):(this.a=new c(i),this.b=new c(t))}set(i,t){this.a=new c(i),this.b=new c(t)}zero(){this.a.setCoords(0,0),this.b.setCoords(0,0)}add(i){const{a:t,b:e}=i;this.a.setCoords(this.a.x+t.x,this.a.y+t.y),this.b.setCoords(this.b.x+e.x,this.b.y+e.y)}substract(i){const{a:t,b:e}=i;this.a.setCoords(this.a.x-t.x,this.a.y-t.y),this.b.setCoords(this.b.x-e.x,this.b.y-e.y)}reflect(i){const t=this.project(i),e={x:this.b.x-2*t.x,y:this.b.y-2*t.y};this.b.setCoords(this.a.x+e.x,this.a.y+e.y)}project(i){const t=i.x**2+i.y**2;if(t===0)return{x:0,y:0};const e=(this.b.x-this.a.x)*i.x+(this.b.y-this.a.y)*i.y;return{x:e/t*i.x,y:e/t*i.y}}get length(){const{a:i,b:t}=this,e=t.x-i.x,s=t.y-i.y;return Math.sqrt(e**2+s**2)}get normalized(){const i=this.length;return i!==0?{x:(this.b.x-this.a.x)/i,y:(this.b.y-this.a.y)/i}:{x:0,y:0}}}const l=document.getElementById("canvas");l.width=window.innerWidth-5;l.height=window.innerHeight-5;l.style.width=`${l.width-5}px`;l.style.height=`${l.height-5}px`;const b=document.getElementById("balls_counter"),A=document.getElementById("reset_button");let x=0;b.innerText="0";A.addEventListener("click",()=>{d.entities.flushEntities(),x=0,O(),g()});const B=new u({x:0,y:0},{y:9.8,x:0});class v{constructor(){n(this,"_deltaTime",0);n(this,"lastTimeUpdate",Date.now())}get deltaTime(){return this._deltaTime}update(){this._deltaTime=(Date.now()-this.lastTimeUpdate)/1e3,this.deltaTime>2&&(this._deltaTime=0),this.lastTimeUpdate=Date.now()}}const f=class f{constructor(){n(this,"id");this.id=`entity_${f.ENTITIES_COUNT}`,f.ENTITIES_COUNT+=1}};n(f,"ENTITIES_COUNT",0);let p=f;class I{constructor(i){n(this,"list",new Map);i&&i.forEach(t=>{this.list.set(t.id,t)})}getList(){return Array.from(this.list.values())}addEntity(...i){for(const t of i){if(this.list.has(t.id))throw new Error(`Entity with id ${t.id} is already exist!`);this.list.set(t.id,t)}return this.getList()}removeEntity(i){this.list.has(i.id)!==!1&&this.list.delete(i.id)}flushEntities(){this.getList().forEach(i=>{this.removeEntity(i)})}}class m{constructor(i,t){n(this,"x",0);n(this,"y",0);i&&(this.x=i),t&&(this.y=t)}}const w=["red","blue","yellow","orange","green","purple","cyan"];class C extends p{constructor(t){super();n(this,"position",new m);n(this,"radius",y.radius*.04);n(this,"speed",new u);n(this,"energyLossCoefficient",.9);n(this,"color",w[Math.floor(Math.random()*w.length)]);n(this,"onBallCollideOtherBall",null);n(this,"onCollideWithArena",null);t&&(t.initialPosition&&(this.position=new m(t.initialPosition.x,t.initialPosition.y)),t.size&&(this.radius=t.size),t.onArenaCollide&&(this.onCollideWithArena=t.onArenaCollide),t.onBallCollide&&(this.onBallCollideOtherBall=t.onBallCollide))}checkCollisionWithBall(t){return new u(this.position,t.position).length<=this.radius+t.radius}render(t){const{x:e,y:s}=this.position;t.beginPath(),t.arc(e,s,this.radius,0,Math.PI*2),t.closePath(),t.fillStyle=this.color,t.fill(),t.strokeStyle="black",t.lineWidth=2,t.stroke()}update(t){var e;this.applyGravity(),this.position.y+=this.speed.b.y*t.deltaTime,this.position.x+=this.speed.b.x*t.deltaTime,this.checkArenaCollision(y)&&(this.teleportInsideArena(y),this.reflectFromArenaWall(y),(e=this.onCollideWithArena)==null||e.call(this,this,y))}applyGravity(){this.speed.add(B)}checkArenaCollision(t){return new u(t.position,this.position).length>t.radius-this.radius}teleportInsideArena(t){const e=new u(t.position,this.position),s={x:t.position.x+e.normalized.x*(t.radius-this.radius+5),y:t.position.y+e.normalized.y*(t.radius-this.radius+5)};this.position=s}reflectFromArenaWall(t){const e=new u(t.position,this.position);if(e.length>=t.radius-this.radius){const s=e.normalized,o=e.length-(t.radius-this.radius);this.speed.reflect(s),this.speed.b.multiply(this.energyLossCoefficient),this.position.x-=s.x*o,this.position.y-=s.y*o}}}class M{constructor(i,t){n(this,"timer",new v);n(this,"ctx");n(this,"entities");const e=i.getContext("2d");if(!e)throw new Error("Cannot get rendering context");this.ctx=e,this.entities=new I(t)}applyActionForEveryEntity(i){for(const t of this.entities.getList())i(t)}update(){this.timer.update(),this.applyActionForEveryEntity(i=>{i.update(this.timer)})}checkCollisions(){var t,e;const i=this.entities.getList().filter(s=>s instanceof C);for(let s=0;s<i.length;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const h=i[a];if(!h)continue;o.checkCollisionWithBall(h)&&((t=o.onBallCollideOtherBall)==null||t.call(o,o,h),(e=h.onBallCollideOtherBall)==null||e.call(h,h,o))}}}clearBackground(i){i.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.clearBackground(this.ctx),this.applyActionForEveryEntity(i=>{i.render(this.ctx)})}play(){this.update(),this.checkCollisions(),this.render(),window.requestAnimationFrame(this.play.bind(this))}}class E extends p{constructor(){super(...arguments);n(this,"radius",Math.min(l.height,l.width)/2*.8);n(this,"position",{x:l.width/2,y:l.height/2})}render(t){t.lineWidth=4,t.strokeStyle="black",t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),t.closePath(),t.stroke()}update(){}}const d=new M(l);function g(){const i=Math.random()*2*Math.PI,t=new C({initialPosition:{x:l.width/2+45*Math.cos(i),y:l.height/2+45*Math.sin(i)},onArenaCollide:()=>{g()},onBallCollide:(o,a)=>{d.entities.removeEntity(o),d.entities.removeEntity(a)}}),e=Math.random()*900,s=Math.random()*350;t.speed.b.setX(Math.random()>=.5?e:-e),t.speed.b.setY(Math.random()>=.5?s:-s),d.entities.addEntity(t),L()}function P(){b.innerText=x.toString()}function L(){x+=1,P()}function O(){const r=new E;d.entities.addEntity(r)}const y=new E;d.entities.addEntity(y);g();d.play();
