var T=Object.defineProperty;var A=(r,e,t)=>e in r?T(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(A(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class I{constructor(){n(this,"soundsEnabled",!1);n(this,"audioCtx",null);n(this,"masterGain",null);n(this,"currentFrequencyIdx",0);n(this,"willFrequencyIncrement",!0);n(this,"frequencies",[261.63,293.66,329.63,349.23,392,440,493.88,523.25]);n(this,"beepDuration",.25)}switchFrequency(){this.willFrequencyIncrement&&this.currentFrequencyIdx+1>=this.frequencies.length&&(this.willFrequencyIncrement=!1),this.willFrequencyIncrement===!1&&this.currentFrequencyIdx-1<0&&(this.willFrequencyIncrement=!0),this.willFrequencyIncrement?this.currentFrequencyIdx++:this.currentFrequencyIdx--}enableSounds(){this.soundsEnabled=!0,this.audioCtx=new AudioContext,this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination),this.masterGain.gain.value=.01}disableSounds(){this.soundsEnabled=!1,this.audioCtx=null}beep(){if(!this.soundsEnabled||!this.audioCtx)return;const e=this.audioCtx.createOscillator(),t=this.audioCtx.createGain();e.connect(t),t.connect(this.audioCtx.destination),e.type="sine",e.frequency.setValueAtTime(this.frequencies[this.currentFrequencyIdx],this.audioCtx.currentTime),t.gain.setValueAtTime(0,this.audioCtx.currentTime),t.gain.linearRampToValueAtTime(.5,this.audioCtx.currentTime+this.beepDuration*(1/3)),t.gain.linearRampToValueAtTime(0,this.audioCtx.currentTime+this.beepDuration*(2/3)),e.start(),e.stop(this.audioCtx.currentTime+this.beepDuration),setTimeout(()=>{e.disconnect(),t.disconnect()},this.beepDuration*1e3),this.switchFrequency()}}class c{constructor(e,t){n(this,"_x",0);n(this,"_y",0);if(typeof e=="object"){const{x:i,y:s}=e;this._x=i,this._y=s;return}e&&(this._x=e),t&&(this._y=t)}get x(){return this._x}get y(){return this._y}getCoords(){return{x:this.x,y:this.y}}setCoords(e,t){this._x=e,this._y=t}setX(e){this._x=e}setY(e){this._y=e}addX(e){this._x+=e}addY(e){this._y+=e}subtractX(e){this._x-=e}subtractY(e){this._y-=e}multiply(e){this._x*=e,this._y*=e}}class u{constructor(e,t){n(this,"a");n(this,"b");!e&&!t?(this.a=new c,this.b=new c):(this.a=new c(e),this.b=new c(t))}set(e,t){this.a=new c(e),this.b=new c(t)}zero(){this.a.setCoords(0,0),this.b.setCoords(0,0)}add(e){const{a:t,b:i}=e;this.a.setCoords(this.a.x+t.x,this.a.y+t.y),this.b.setCoords(this.b.x+i.x,this.b.y+i.y)}substract(e){const{a:t,b:i}=e;this.a.setCoords(this.a.x-t.x,this.a.y-t.y),this.b.setCoords(this.b.x-i.x,this.b.y-i.y)}reflect(e){const t=this.project(e),i={x:this.b.x-2*t.x,y:this.b.y-2*t.y};this.b.setCoords(this.a.x+i.x,this.a.y+i.y)}project(e){const t=e.x**2+e.y**2;if(t===0)return{x:0,y:0};const i=(this.b.x-this.a.x)*e.x+(this.b.y-this.a.y)*e.y;return{x:i/t*e.x,y:i/t*e.y}}get length(){const{a:e,b:t}=this,i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i**2+s**2)}get normalized(){const e=this.length;return e!==0?{x:(this.b.x-this.a.x)/e,y:(this.b.y-this.a.y)/e}:{x:0,y:0}}}const l=document.getElementById("canvas");l.width=window.innerWidth-5;l.height=window.innerHeight-5;l.style.width=`${l.width-5}px`;l.style.height=`${l.height-5}px`;const E=document.getElementById("balls_counter"),_=document.getElementById("reset_button"),m=document.getElementById("enable_sounds_button");let b=0;E.innerText="0";_.addEventListener("click",()=>{a.removeAllBalls(),b=0,g()});m.addEventListener("click",()=>{a.sound.soundsEnabled?(a.sound.disableSounds(),m.innerText="Enable sounds"):(a.sound.enableSounds(),m.innerText="Mute")});const B=new u({x:0,y:0},{y:9.8,x:0});class q{constructor(){n(this,"_deltaTime",0);n(this,"lastTimeUpdate",Date.now())}get deltaTime(){return this._deltaTime}update(){this._deltaTime=(Date.now()-this.lastTimeUpdate)/1e3,this.deltaTime>2&&(this._deltaTime=0),this.lastTimeUpdate=Date.now()}}const f=class f{constructor(){n(this,"id");this.id=`entity_${f.ENTITIES_COUNT}`,f.ENTITIES_COUNT+=1}};n(f,"ENTITIES_COUNT",0);let p=f;class v{constructor(e){n(this,"list",new Map);e&&e.forEach(t=>{this.list.set(t.id,t)})}getList(){return Array.from(this.list.values())}addEntity(...e){for(const t of e){if(this.list.has(t.id))throw new Error(`Entity with id ${t.id} is already exist!`);this.list.set(t.id,t)}return this.getList()}removeEntity(e){this.list.has(e.id)!==!1&&this.list.delete(e.id)}flushEntities(){this.getList().forEach(e=>{this.removeEntity(e)})}}class C{constructor(e,t){n(this,"x",0);n(this,"y",0);e&&(this.x=e),t&&(this.y=t)}}const w=["red","blue","yellow","orange","green","purple","cyan"];class x extends p{constructor(t){super();n(this,"position",new C);n(this,"radius",y.radius*.04);n(this,"speed",new u);n(this,"energyLossCoefficient",1);n(this,"color",w[Math.floor(Math.random()*w.length)]);n(this,"onBallCollideOtherBall",null);n(this,"onCollideWithArena",null);t&&(t.initialPosition&&(this.position=new C(t.initialPosition.x,t.initialPosition.y)),t.size&&(this.radius=t.size),t.onArenaCollide&&(this.onCollideWithArena=t.onArenaCollide),t.onBallCollide&&(this.onBallCollideOtherBall=t.onBallCollide))}checkCollisionWithBall(t){return new u(this.position,t.position).length<=this.radius+t.radius}render(t){const{x:i,y:s}=this.position;t.beginPath(),t.arc(i,s,this.radius,0,Math.PI*2),t.closePath(),t.fillStyle=this.color,t.fill(),t.strokeStyle="black",t.lineWidth=2,t.stroke()}update(t){var i;this.applyGravity(),this.position.y+=this.speed.b.y*t.deltaTime,this.position.x+=this.speed.b.x*t.deltaTime,this.checkArenaCollision(y)&&(this.teleportInsideArena(y),this.reflectFromArenaWall(y),(i=this.onCollideWithArena)==null||i.call(this,this,y))}applyGravity(){this.speed.add(B)}checkArenaCollision(t){return new u(t.position,this.position).length>t.radius-this.radius}teleportInsideArena(t){const i=new u(t.position,this.position),s={x:t.position.x+i.normalized.x*(t.radius-this.radius+5),y:t.position.y+i.normalized.y*(t.radius-this.radius+5)};this.position=s}reflectFromArenaWall(t){const i=new u(t.position,this.position);if(i.length>=t.radius-this.radius){const s=i.normalized,o=i.length-(t.radius-this.radius);this.speed.reflect(s),this.speed.b.multiply(this.energyLossCoefficient),this.position.x-=s.x*o,this.position.y-=s.y*o}}}class F{constructor(e,t){n(this,"timer",new q);n(this,"ctx");n(this,"entities");n(this,"sound",new I);const i=e.getContext("2d");if(!i)throw new Error("Cannot get rendering context");this.ctx=i,this.entities=new v(t)}removeAllBalls(){this.entities.getList().forEach(e=>{e instanceof x&&this.entities.removeEntity(e)})}applyActionForEveryEntity(e){for(const t of this.entities.getList())e(t)}update(){this.timer.update(),this.applyActionForEveryEntity(e=>{e.update(this.timer)})}checkCollisions(){var t,i;const e=this.entities.getList().filter(s=>s instanceof x);for(let s=0;s<e.length;s++){const o=e[s];for(let h=s+1;h<e.length;h++){const d=e[h];if(!d)continue;o.checkCollisionWithBall(d)&&((t=o.onBallCollideOtherBall)==null||t.call(o,o,d),(i=d.onBallCollideOtherBall)==null||i.call(d,d,o))}}}clearBackground(e){e.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.clearBackground(this.ctx),this.applyActionForEveryEntity(e=>{e.render(this.ctx)})}play(){this.update(),this.checkCollisions(),this.render(),window.requestAnimationFrame(this.play.bind(this))}}class M extends p{constructor(){super(...arguments);n(this,"radius",Math.min(l.height,l.width)/2*.8);n(this,"position",{x:l.width/2,y:l.height/2})}render(t){t.lineWidth=4,t.strokeStyle="black",t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),t.closePath(),t.stroke()}update(){}}const a=new F(l);function g(){const e=Math.random()*2*Math.PI,t=new x({initialPosition:{x:l.width/2+45*Math.cos(e),y:l.height/2+45*Math.sin(e)},onArenaCollide:()=>{g(),a.sound.beep()},onBallCollide:(o,h)=>{a.entities.removeEntity(o),a.entities.removeEntity(h)}}),i=Math.random()*900,s=Math.random()*350;t.speed.b.setX(Math.random()>=.5?i:-i),t.speed.b.setY(Math.random()>=.5?s:-s),a.entities.addEntity(t),P()}function L(){E.innerText=b.toString()}function P(){b+=1,L()}const y=new M;a.entities.addEntity(y);g();a.play();
